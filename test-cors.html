<!DOCTYPE html>
<html>
<head>
  <title>Test Supabase CORS</title>
</head>
<body>
  <h1>Supabase Storage CORS æµ‹è¯•</h1>
  <button onclick="testCORS()">æµ‹è¯• CORS</button>
  <pre id="result"></pre>

  <script>
    async function testCORS() {
      const result = document.getElementById('result');
      result.textContent = 'æµ‹è¯•ä¸­...\n';

      // æ›¿æ¢ä¸ºä½ å®žé™…çš„ EPUB æ–‡ä»¶ URL
      const url = 'https://ybjswwpdyppahxhhylij.supabase.co/storage/v1/object/public/user_books/583bb19a-2078-47b0-9101-c5ec9a38dedd/583bb19a-2078-47b0-9101-c5ec9a38dedd-1763617425803-ot7gle.epub';
      
      try {
        // æµ‹è¯• 1: æ™®é€š GET è¯·æ±‚
        result.textContent += 'æµ‹è¯• 1: æ™®é€š GET è¯·æ±‚\n';
        const res1 = await fetch(url, { method: 'GET' });
        result.textContent += `âœ… Status: ${res1.status}\n`;
        result.textContent += `âœ… CORS Header: ${res1.headers.get('access-control-allow-origin')}\n\n`;

        // æµ‹è¯• 2: HEAD è¯·æ±‚
        result.textContent += 'æµ‹è¯• 2: HEAD è¯·æ±‚\n';
        const res2 = await fetch(url, { method: 'HEAD' });
        result.textContent += `âœ… Status: ${res2.status}\n`;
        result.textContent += `âœ… Accept-Ranges: ${res2.headers.get('accept-ranges')}\n\n`;

        // æµ‹è¯• 3: Range è¯·æ±‚
        result.textContent += 'æµ‹è¯• 3: Range è¯·æ±‚ï¼ˆEPUB.js éœ€è¦ï¼‰\n';
        const res3 = await fetch(url, {
          method: 'GET',
          headers: { 'Range': 'bytes=0-1023' }
        });
        result.textContent += `âœ… Status: ${res3.status}\n`;
        result.textContent += `âœ… Content-Range: ${res3.headers.get('content-range')}\n`;
        result.textContent += `âœ… CORS Header: ${res3.headers.get('access-control-allow-origin')}\n\n`;

        if (res3.status === 206 || res3.status === 200) {
          result.textContent += 'ðŸŽ‰ CORS é…ç½®æ­£ç¡®ï¼EPUB åº”è¯¥å¯ä»¥åŠ è½½ã€‚\n';
        } else {
          result.textContent += 'âŒ Range è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦é…ç½® CORSã€‚\n';
        }

      } catch (error) {
        result.textContent += `âŒ é”™è¯¯: ${error.message}\n`;
        result.textContent += '\nå¦‚æžœæ˜¯ CORS é”™è¯¯ï¼Œè¯´æ˜Žéœ€è¦é…ç½® Storage CORSã€‚\n';
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
    window.onload = () => {
      testCORS();
    };
  </script>
</body>
</html>
