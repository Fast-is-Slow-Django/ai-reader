# 测试指南

完整的功能测试流程和检查清单。

## 🧪 测试环境准备

### **1. 启动开发服务器**

```bash
npm run dev
```

访问：`http://localhost:3000`

### **2. 准备测试数据**

- 至少准备 1 个 EPUB 文件（用于上传测试）
- 准备多个 EPUB 文件（测试多书籍场景）

---

## ✅ 功能测试清单

### **阶段 1: 认证系统**

#### **1.1 注册功能**

- [ ] 访问 `/login`
- [ ] 输入新邮箱和密码（≥6位）
- [ ] 点击"创建新账号"
- [ ] ✅ 应该跳转到 `/dashboard`
- [ ] ❌ 密码少于6位应提示错误
- [ ] ❌ 邮箱格式错误应提示错误

#### **1.2 登录功能**

- [ ] 访问 `/login`
- [ ] 输入已注册的邮箱和密码
- [ ] 点击"登录"
- [ ] ✅ 应该跳转到 `/dashboard`
- [ ] ❌ 错误密码应提示"邮箱或密码错误"

#### **1.3 路由保护**

- [ ] 未登录时访问 `/dashboard`
- [ ] ✅ 应该重定向到 `/login?redirectTo=/dashboard`
- [ ] 登录后
- [ ] ✅ 应该返回到 `/dashboard`

#### **1.4 退出登录**

- [ ] 登录后点击右上角"退出登录"
- [ ] ✅ 应该返回到 `/login`
- [ ] 再次访问 `/dashboard`
- [ ] ✅ 应该被重定向到 `/login`

---

### **阶段 2: 书架功能**

#### **2.1 空状态显示**

- [ ] 新用户登录后访问 `/dashboard`
- [ ] ✅ 应该显示"还没有书籍"提示
- [ ] ✅ 应该显示上传器卡片
- [ ] ✅ 统计显示"共 0 本书籍"

#### **2.2 上传功能（基础版）**

- [ ] 点击"上传书籍"卡片
- [ ] 选择 `.epub` 文件
- [ ] ✅ 应该显示"上传中..."加载状态
- [ ] ✅ 应该显示进度文字（准备上传 → 上传文件 → 保存信息）
- [ ] ✅ 成功后弹出提示
- [ ] ✅ 书籍自动出现在书架
- [ ] ✅ 统计更新为"共 1 本书籍"

#### **2.3 上传验证**

- [ ] 尝试上传非 `.epub` 文件
- [ ] ❌ 应该提示"只支持 EPUB 格式"
- [ ] 尝试上传超过 50MB 的文件
- [ ] ❌ 应该提示文件过大

#### **2.4 书籍显示**

- [ ] 上传多本书籍
- [ ] ✅ 书籍按时间倒序排列（最新在前）
- [ ] ✅ 每本书显示标题和上传日期
- [ ] ✅ 悬停时卡片阴影增强
- [ ] ✅ 悬停时显示"点击阅读"提示

#### **2.5 响应式布局**

- [ ] 在不同屏幕尺寸测试
  - 手机（< 640px）：✅ 2列
  - 平板（≥ 640px）：✅ 3列
  - 笔记本（≥ 768px）：✅ 4列
  - 桌面（≥ 1024px）：✅ 5列

---

### **阶段 3: 阅读器页面**

#### **3.1 访问阅读器**

- [ ] 在书架点击任意书籍
- [ ] ✅ 应该跳转到 `/read/[book-id]`
- [ ] ✅ 页面标题显示书名
- [ ] ✅ 顶部显示书名和进度
- [ ] ✅ 底部显示翻页按钮（当前禁用）

#### **3.2 加载状态**

- [ ] 刚进入阅读器页面
- [ ] ✅ 应该显示加载动画（旋转图标）
- [ ] ✅ 显示"加载中..."文字
- [ ] ✅ 显示"正在打开《书名》"
- [ ] 1秒后
- [ ] ✅ 显示"阅读器开发中"占位内容

#### **3.3 权限验证**

- [ ] 复制一个书籍的 ID
- [ ] 退出登录
- [ ] 访问 `/read/[刚才的ID]`
- [ ] ✅ 应该重定向到 `/login?redirectTo=/read/[ID]`
- [ ] 登录后
- [ ] ✅ 应该自动返回阅读器页面

#### **3.4 无效书籍处理**

- [ ] 访问 `/read/invalid-id-12345`
- [ ] ✅ 应该重定向到 `/dashboard`
- [ ] 控制台应该有错误日志

---

### **阶段 4: 端到端流程**

#### **完整用户旅程**

```
1. [ ] 访问首页 → 登录页
2. [ ] 注册新账号 → 书架页（空）
3. [ ] 上传第一本书 → 显示在书架
4. [ ] 点击书籍 → 阅读器页面
5. [ ] 返回书架 → 上传第二本书
6. [ ] 查看书架 → 两本书都显示
7. [ ] 点击另一本书 → 阅读器正常
8. [ ] 退出登录 → 登录页
9. [ ] 重新登录 → 书籍仍在
```

---

## 🔍 性能测试

### **1. 页面加载速度**

- [ ] 登录页面 < 1s
- [ ] 书架页面（0本书）< 1s
- [ ] 书架页面（10本书）< 2s
- [ ] 阅读器页面 < 2s

### **2. 上传速度**

- [ ] 1MB EPUB < 3s
- [ ] 10MB EPUB < 10s
- [ ] 50MB EPUB < 30s

### **3. 网络测试**

- [ ] 开发者工具 → Network → Throttling
- [ ] 测试 Slow 3G 网络下的表现
- [ ] ✅ 应该显示加载状态
- [ ] ✅ 不应该卡死或崩溃

---

## 📱 移动端测试

### **1. 响应式设计**

```bash
# Chrome DevTools
F12 → Toggle device toolbar (Ctrl+Shift+M)

测试设备：
- iPhone SE (375px)
- iPhone 12 Pro (390px)
- iPad (768px)
- iPad Pro (1024px)
```

#### **检查项目**

- [ ] 登录页面布局正常
- [ ] 输入框大小合适（可点击）
- [ ] 按钮大小足够（≥44px高度）
- [ ] 书架网格正确显示
- [ ] 书籍卡片可点击
- [ ] 上传器可点击
- [ ] 文字不重叠
- [ ] 没有横向滚动条

### **2. 触摸交互**

- [ ] 点击上传器触发文件选择
- [ ] 点击书籍进入阅读器
- [ ] 点击退出按钮正常工作
- [ ] 表单输入正常
- [ ] 按钮有点击反馈

---

## 🐛 错误场景测试

### **1. 网络错误**

- [ ] 开发者工具 → Network → Offline
- [ ] 尝试登录
- [ ] ❌ 应该显示错误提示
- [ ] 尝试上传
- [ ] ❌ 应该显示错误提示

### **2. Supabase 配置错误**

- [ ] 修改 `.env.local` 为错误的 URL
- [ ] 重启服务器
- [ ] 访问任何页面
- [ ] ❌ 应该显示友好的错误信息

### **3. 文件损坏**

- [ ] 尝试上传损坏的 EPUB 文件
- [ ] 当前：✅ 可以上传（验证不严格）
- [ ] 未来：❌ 应该验证文件完整性

---

## 🔐 安全测试

### **1. SQL 注入防护**

- [ ] 登录时输入：`' OR '1'='1`
- [ ] ✅ 应该登录失败（Supabase 自动防护）

### **2. XSS 防护**

- [ ] 上传书名包含：`<script>alert('XSS')</script>`
- [ ] ✅ 应该显示为纯文本（React 自动转义）

### **3. 权限隔离**

- [ ] 用户 A 上传书籍
- [ ] 获取书籍 ID
- [ ] 用户 B 登录
- [ ] 尝试访问用户 A 的书籍 `/read/[A的书籍ID]`
- [ ] ✅ 应该重定向到 `/dashboard`

---

## 📊 浏览器兼容性

### **桌面端**

- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)

### **移动端**

- [ ] iOS Safari
- [ ] Android Chrome
- [ ] 微信内置浏览器

---

## 🎨 UI/UX 检查

### **1. 视觉一致性**

- [ ] 颜色使用一致（蓝色主题）
- [ ] 圆角统一（卡片都是 rounded-2xl）
- [ ] 阴影统一（shadow-sm → shadow-xl）
- [ ] 字体大小合理

### **2. 交互反馈**

- [ ] 按钮有悬停效果
- [ ] 加载时显示动画
- [ ] 操作成功有提示
- [ ] 操作失败有错误信息

### **3. 无障碍性**

- [ ] 表单有 label
- [ ] 按钮有明确文字
- [ ] 颜色对比度足够
- [ ] 键盘可导航（Tab 键）

---

## 📝 测试记录模板

```markdown
## 测试日期：2025-11-20

### 测试人员：[名字]

### 测试环境
- 浏览器：Chrome 120
- 操作系统：Windows 11
- 屏幕尺寸：1920x1080

### 测试结果

#### 认证系统
- [x] 注册功能 - ✅ 通过
- [x] 登录功能 - ✅ 通过
- [x] 退出功能 - ✅ 通过
- [ ] 密码重置 - ⏳ 未实现

#### 书架功能
- [x] 上传功能 - ✅ 通过
- [x] 显示功能 - ✅ 通过
- [ ] 删除功能 - ⏳ 未实现

#### 阅读器
- [x] 页面加载 - ✅ 通过
- [x] 权限验证 - ✅ 通过
- [ ] EPUB 渲染 - ⏳ 未实现

### 发现的问题

1. **问题描述**：xxx
   - 重现步骤：xxx
   - 预期行为：xxx
   - 实际行为：xxx
   - 严重程度：高/中/低

### 改进建议

1. xxx
2. xxx
```

---

## 🚀 自动化测试（可选）

### **E2E 测试框架**

```bash
# 安装 Playwright
npm install -D @playwright/test

# 创建测试文件
tests/
  ├── auth.spec.ts
  ├── upload.spec.ts
  └── reader.spec.ts
```

### **示例测试**

```typescript
// tests/auth.spec.ts
import { test, expect } from '@playwright/test'

test('用户可以注册和登录', async ({ page }) => {
  await page.goto('http://localhost:3000/login')
  
  // 注册
  await page.fill('input[name="email"]', 'test@example.com')
  await page.fill('input[name="password"]', '123456')
  await page.click('button:has-text("创建新账号")')
  
  // 验证跳转
  await expect(page).toHaveURL('/dashboard')
})
```

---

## ✅ 部署前检查清单

- [ ] 所有功能测试通过
- [ ] 移动端测试通过
- [ ] 性能达标
- [ ] 安全检查通过
- [ ] 浏览器兼容性确认
- [ ] 无控制台错误
- [ ] 环境变量配置正确
- [ ] 数据库 Schema 已应用
- [ ] Storage Policies 已配置
- [ ] 404 页面正常显示
- [ ] 500 错误有友好提示

---

**测试状态**: ✅ 当前阶段所有核心功能可测试
