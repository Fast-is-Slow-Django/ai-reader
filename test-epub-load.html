<!DOCTYPE html>
<html>
<head>
  <title>EPUB åŠ è½½æµ‹è¯•</title>
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
</head>
<body>
  <h1>EPUB åŠ è½½æµ‹è¯•</h1>
  <div id="status"></div>
  <div id="viewer" style="height: 600px; border: 1px solid #ccc; margin-top: 20px;"></div>

  <script>
    const statusDiv = document.getElementById('status');
    
    // æ›¿æ¢ä¸ºä½ çš„å®é™… EPUB æ–‡ä»¶ URL
    const epubUrl = 'https://ybjswwpdyppahxhhylij.supabase.co/storage/v1/object/public/user_books/583bb19a-2078-47b0-9101-c5ec9a38dedd/583bb19a-2078-47b0-9101-c5ec9a38dedd-1763617425803-ot7gle.epub';
    
    statusDiv.innerHTML = 'æ­£åœ¨åŠ è½½ EPUB...';
    
    // æµ‹è¯• 1: ç›´æ¥ fetch
    fetch(epubUrl)
      .then(res => {
        statusDiv.innerHTML += `<br>âœ… Fetch æˆåŠŸ: ${res.status}`;
        statusDiv.innerHTML += `<br>âœ… CORS Header: ${res.headers.get('access-control-allow-origin')}`;
        return res.blob();
      })
      .then(blob => {
        statusDiv.innerHTML += `<br>âœ… æ–‡ä»¶å¤§å°: ${(blob.size / 1024 / 1024).toFixed(2)} MB`;
        
        // æµ‹è¯• 2: EPUB.js åŠ è½½
        statusDiv.innerHTML += `<br><br>æ­£åœ¨ç”¨ EPUB.js è§£æ...`;
        
        const book = ePub(epubUrl);
        const rendition = book.renderTo("viewer", {
          width: "100%",
          height: "100%"
        });
        
        rendition.display();
        
        book.ready.then(() => {
          statusDiv.innerHTML += `<br>ğŸ‰ EPUB åŠ è½½æˆåŠŸï¼`;
          statusDiv.innerHTML += `<br>æ ‡é¢˜: ${book.packaging.metadata.title}`;
        }).catch(err => {
          statusDiv.innerHTML += `<br>âŒ EPUB.js è§£æå¤±è´¥: ${err.message}`;
          console.error('EPUB.js é”™è¯¯:', err);
        });
      })
      .catch(err => {
        statusDiv.innerHTML += `<br>âŒ åŠ è½½å¤±è´¥: ${err.message}`;
        console.error('åŠ è½½é”™è¯¯:', err);
      });
  </script>
</body>
</html>
